<!DOCTYPE html>
<html>
<head>
  <title>JSON Editor</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    #saveBtn {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <table id="jsonTable"></table>
  <button id="saveBtn">Spremi</button>

  <script type="application/javascript">

const chats = {
  chat_0_01_BALK: {
    steps: [
      {
        type: "playerLine",
        line: "Neki balkon."
      },
      {
        type: "eginaLine",
        line: "S njega je providur Dalmacije nadgledao regiju svoje uprave."
      }
    ]
  },
  chat_0_02: {
    steps: [
      {
        type: "eginaLine",
        line: "Napokon! Uđi u muzej.",
        delay: 1500
      },
      {
        type: "eginaLine",
        line: "Obrati pažnju na svaki detalj. Sve može biti korisno.",
        delay: 1500
      }
    ]
  }
};

// Function to generate the table rows from JSON data
function generateTableRows(data, parentKey = "") {
  let rows = "";

  for (let key in data) {
    if (typeof data[key] === "object" && !Array.isArray(data[key])) {
      rows += generateTableRows(data[key], parentKey + key + "_");
    } else {
      const inputId = parentKey + key;
      const value = JSON.stringify(data[key]);

      rows += `
        <tr>
          <td>${inputId}</td>
          <td><input type="text" id="${inputId}" value='${value}'></td>
        </tr>
      `;
    }
  }

  return rows;
}

// Function to update the JSON data based on the table input values
function updateJsonFromTable() {
  const inputs = document.getElementsByTagName("input");

  for (let input of inputs) {
    const id = input.id;
    const value = input.value;

    try {
      const parsedValue = JSON.parse(value);
      setObjectValue(chats, id.split("_"), parsedValue);
    } catch (error) {
      console.error(`Invalid JSON value for ${id}: ${value}`);
    }
  }
}

// Helper function to set a value within a nested object based on the provided path
function setObjectValue(obj, path, value) {
  for (let i = 0; i < path.length - 1; i++) {
    obj = obj[path[i]];
  }
  obj[path[path.length - 1]] = value;
}

// Function to save the changes back to the JSON file
function saveChanges() {
  updateJsonFromTable();

  // Convert the updated JSON data to a string
  const jsonString = JSON.stringify(chats, null, 2);

  // Create a Blob object with the JSON string
  const blob = new Blob([jsonString], { type: "application/json" });

  // Create a temporary anchor element to trigger the download
  const downloadLink = document.createElement("a");
  downloadLink.href = URL.createObjectURL(blob);
  downloadLink.download = "data.json";

  // Trigger the download
  downloadLink.click();
}

// Generate the table rows from JSON data and add them to the table
const jsonTable = document.getElementById("jsonTable");
jsonTable.innerHTML = generateTableRows(chats);

// Add event listener to the "Save" button
const saveBtn = document.getElementById("saveBtn");
saveBtn.addEventListener("click", saveChanges);



  </script>
</body>
</html>